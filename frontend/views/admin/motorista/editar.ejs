<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Nimbus | Motorista</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/admin/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/admin/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/admin/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="/admin/assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="/admin/assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="/admin/assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="/admin/assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="/admin/assets/css/style.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

  <!-- =======================================================
  * Template Name: NiceAdmin
  * Updated: Aug 30 2023 with Bootstrap v5.3.1
  * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <%- include('../partials/_header.ejs'); -%>
  <%- include('../partials/_aside.ejs'); -%>


  <main id="main" class="main">

    <div class="pagetitle">
      <h1>Editar Motorista</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item active"><a href="/admin/">Página Inicial</a></li>
          <li class="breadcrumb-item active">Editar Motorista</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <div class="row">

      <!-- formulario de edição -->
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Formulário de Edição</h5>
            <!-- <div id="detalhes-motorista"> -->
              <!-- As informações do motorista serão adicionadas dinamicamente aqui -->
            <!-- </div> -->
            <form id="form" class="row g-3 needs-validation" novalidate enctype="multipart/form-data">

              <!-- Nome -->
              <div class="col-md-6">
                <label for="nome" class="form-label">Nome Completo</label>
                <input name="nome" type="text" pattern="^[\p{L}]+(?: [\p{L}]+)*$" autocomplete="nome" class="form-control" id="nome" required>
                <div class="valid-feedback">
                  Tudo certo!
                </div>
                <div class="invalid-feedback">
                  Nome é um campo obrigatório, utilize apenas caracteres alfabéticos.
                </div>
              </div>

              <!-- CPF -->

              <div class="col-md-6">
                <label for="cpf" class="form-label">CPF</label>
                <input name="cpf" id="cpf" type="text" class="form-control" autocomplete="cpf" required maxlength="14">
                <div class="valid-feedback">Tudo certo!</div>
                <div class="invalid-feedback">Informe no formato "999.999.999-99"</div>
              </div>
            
              <!-- Nascimento -->
              <div class="col-md-6">
                <label for="nascimento"  class="form-label">Data de Nascimento</label>
                <input name="nascimento" id="nascimento" type="date" autocomplete="nascimento" class="form-control" placeholder="dd/mm/yyyy" value="" required>
                <div class="valid-feedback">
                  Tudo certo!
                </div>
                <div class="invalid-feedback">
                  Informe uma data válida.
                </div>
              </div>
            
              <!-- Foto -->
              <div class="col-md-6">
                <label for="foto" class="form-label">Foto</label>
                <div class="col-sm-12">
                  <input name="foto" class="form-control" type="file" id="foto" required>
                  <div class="valid-feedback">
                    Tudo certo!
                  </div>
                  <div class="invalid-feedback">
                    Selecione uma imagem.
                  </div>
                </div>
              </div>
              <br>
              <div class="col-12">
                <button class="btn btn-primary" type="submit">Salvar Edições</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- End formulario -->

  </main>

  <%- include('../partials/_footer.ejs'); -%>

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="/admin/assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="/admin/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/admin/assets/vendor/chart.js/chart.umd.js"></script>
  <script src="/admin/assets/vendor/echarts/echarts.min.js"></script>
  <script src="/admin/assets/vendor/quill/quill.min.js"></script>
  <script src="/admin/assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="/admin/assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="/admin/assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
  <script>document.getElementById("cpf").addEventListener("input", function (event) {
    let inputValue = event.target.value;
  
    // Remove caracteres não numéricos
    inputValue = inputValue.replace(/\D/g, "");
  
    // Adiciona pontos e traço conforme o formato do CPF
    if (inputValue.length > 3) {
      inputValue = inputValue.substring(0, 3) + "." + inputValue.substring(3);
    }
    if (inputValue.length > 7) {
      inputValue = inputValue.substring(0, 7) + "." + inputValue.substring(7);
    }
    if (inputValue.length > 11) {
      inputValue = inputValue.substring(0, 11) + "-" + inputValue.substring(11);
    }
  
    // Atualiza o valor no campo de formulário
    event.target.value = inputValue;
  });
  
  document.addEventListener("DOMContentLoaded", async () => {
    try {
      const id = window.location.pathname.split('/').pop();
      const response = await axios.get(`http://localhost:3000/admin/motorista/exibir/${id}`);
      const motorista = response.data;

      const form = document.querySelector("#form");
      const nomeInput = document.querySelector("#nome");
      const cpfInput = document.querySelector("#cpf");
      const nascimentoInput = document.querySelector("#nascimento");
  
      // const fotoAtual = document.querySelector("#fotoAtual");
      // fotoAtual.src = motorista.foto;
  
      nomeInput.value = motorista.nome;
      cpfInput.value = motorista.cpf;
      nascimentoInput.value = motorista.nascimento.split("T")[0];
      
  
      form.addEventListener(
        "submit",
        async (event) => {
          event.preventDefault();
  
          if (form.checkValidity()) {
            try {
              const formData = new FormData(form);
              await axios.put(`http://localhost:3000/admin/motorista/editar/${id}`, formData,{
                  headers: {
                    "Content-Type": "multipart/form-data",
                  },
                }
              );
  
              alert("Motorista editado com sucesso.");
              window.location.href = `/motorista/exibir/${id}`;
            } catch (error) {
              console.log(error);
              alert(error.response.data.mensagem);
            }
          }
  
          form.classList.add("was-validated");
        },
        false
      );
    } catch (error) {
      console.log(error);
  
      if (error?.response?.status === 404) {
        alert("Motorista não encontrado.");
        window.location.href = "/motorista/listar";
      } else {
        alert(error.response.data.mensagem);
      }
    }
  });
  </script>
  <script src="/admin/js/motorista/main.js"></script>
  
</body>

</html>
